<main class='container px-4 mx-auto'>
  <div class="flex flex-col place-items-center">
    <div class="grid bg-base-300 rounded-box place-items-center status-container">
      <ul class="status-keys">
        <li><span class='status-dot available'></span> Available</li>
        <li><span class='status-dot pending'></span> Pending</li>
        <li><span class='status-dot not-available'></span> Not available</li>
      </ul>
    </div>
  </div>
  <div class='grid grid-flow-row gap-8 my-8 text-neutral-600 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3'>
    {{#each items}}
    <div class='p-6 duration-300 shadow-lg rounded-xl shadow-gray-200 bg- hover:-translate-y-1 feed-card card'>
      <a class='trigger-modal' onclick='my_modal_{{this.id}}.showModal()'>
        <span class='status-dot
                    {{#if this.is_available}}
                        {{#if this.requests.length}}
                            pending
                        {{else}}
                            available
                        {{/if}}
                    {{else}}
                        not-available
                    {{/if}}
                '></span>
        <span class='stars'>{{#if this.averageRating}}{{renderStars this.averageRating}}{{else}}<h4 class='not-rated'>
            Not Rated</h4>{{/if}}</span>
        <h2 class='mb-3 card-title'>{{this.item_name}}</h2>
        <p class='mb-3 card-description'>{{{trimString this.item_description}}} ...</p>
        <p class='mb-3 card-condition'><strong>Condition:</strong> {{this.item_condition}}</p>
        <p class='mb-3 card-owner'><strong>Owner:</strong> {{this.owner.firstName}}</p>
        {{#if this.is_available}}
        <p class='mb-3 card-available'><strong>Available:</strong> Yes</p>
        {{else}}
        <p class='mb-3 card-not-available'><strong>Available:</strong> No</p>
        <p class='borrowed-by'><strong>Borrowed by:</strong> <span class='borrowed-by'
            data-item-id='{{this.id}}'>{{this.borrowedBy.firstName}}</span></p>
        {{/if}}
      </a>
    </div>

    <!-- Modal -->
    <dialog class='modal modal-bottom sm:modal-middle' id='my_modal_{{this.id}}' tabindex='-1'
      aria-labelledby='itemModal{{this.id}}Label' aria-hidden='true'>
      <form method='dialog' class='modal-box borrow-card'>
        <i class='fa fa-times close-icon' onclick='my_modal_{{this.id}}.close()'></i>
        <h4 class='modal-title' id='itemModal{{this.id}}Label'>{{this.item_name}}</h4>
        <button type='button' class='btn-close' data-bs-dismiss='modal' aria-label='Close'></button>
        <p class='mb-3'>{{this.item_description}}</p>
        <p class='mb-3'><strong>Condition:</strong> {{this.item_condition}}</p>
        <p class='mb-3'><strong>Available:</strong>
          {{#if this.is_available}}Yes{{else}}No{{/if}}</p>
        <p class='mb-3'><strong>Owner:</strong> {{this.owner.firstName}}</p>

        {{#if reviews}}
        <h2><strong>Review:</strong></h2>
        {{#each reviews}}
        <p>
        <blockquote>'{{this.review_text}}'</blockquote>
        </p>
        {{/each}}
        {{/if}}
        <div class='modal-action'>
          {{#isCurrentUserItem this.user_id ../userId this.is_available}}
          {{#if this.requests.length}}
          <button type='button' class='btn borrow-button' disabled>Pending</button>
          {{else}}
          <button type='button' class='btn borrow-button' data-user-id='{{../userId}}'
            data-item-id='{{this.id}}'>Borrow</button>
          {{/if}}
          {{else if this.is_available}}
          <button type='button' class='btn borrow-button' disabled>You own it</button>
          {{else}}
          <button type='button' class='btn borrow-button' disabled>Borrowed</button>
          {{/isCurrentUserItem}}
        </div>
      </form>
    </dialog>
    {{/each}}
  </div>

</main>
<script src='/js/request.js'></script>